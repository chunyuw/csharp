%% Slides for ".NET Programming" by Chunyu Wang <chunyu@hit.edu.cn>

\part{.NET 框架}

\section{.NET 框架简介}
\begin{frame} \frametitle{什么是 Microsoft .NET} 

  .NET 是 Microsoft 的用以创建 XML Web 服务平台，该平台将信息、设备和人以一种统
  一的、个性化的方式联系起来。

  借助于 .NET 平台，可以创建和使用基于 XML 的应用程序、进程和 Web 站点以及服务，
  它们之间可以按设计、在任何平台或智能设备上共享和组合信息与功能，以向单位和个
  人提供定制好的解决方案。
  
  % Microsoft .NET 扩展了通过任何设备随时随地操作数据和进行通讯的能力。.NET 使
  % 用分布式计算模型并基于开放标准（如 XML）将 PC 与其他智能设备连接在一起。

  % XML 是 Internet 上数据交换的通用语言。它提供了一个广泛包容的、开放标准的技
  % 术，用于数据交换和转换，克服了应用程序和服务互操作性和集成面临的障碍。
  
    \begin{itemize}
    \item 底层操作系统 -- Windows
    \item 辅助产品 -- .NET 企业服务器
    \item 开发以及运行平台 -- .NET 框架
    \item 集成开发环境 -- Visual Studio .NET
    \end{itemize}
  % \begin{itemize}
  % \item Microsoft .NET Framework
  % \item Microsoft Visual Studio
  % \end{itemize}

\end{frame}

\begin{frame} \frametitle{Microsoft .NET 平台的设计目标}

  .NET 框架设计为一个集成环境,可以在Internet，Windows桌面以及移动设备上进行无缝
  地开发和运行应用程序。

  \begin{itemize}
  \item 提供一个覆盖整个应用范围的、一致的面向对象环境；
  \item 简化代码的发布/安装过程，最小化版本冲突问题；
    % DLL Hell
  \item 基于公认的标准，提供一个可移植的环境；
    % C\# 和 .NET CLI 已经得到了 ECMA (欧洲计算机制造协会) 的标准化.
  \item 提供一个可管理的环境，保证程序的安全执行。
  \end{itemize}
  % 兼容 Win32 API 和 COM

\end{frame}

\begin{frame}[t] \frametitle{Microsoft .NET 相关技术标准}
  \begin{itemize}
  \item<1-> XML \only<2->{-- 基于 Web 的结构化数据的通用格式}

    \only<1>{\CJKindent \small XML 是一组设计文本数据格式的规则，所产生的文件意
      义明确并且独立于平台，方便生成和（被计算机）读取。当前，如果一个 Web 应用
      程序要从另一个应用程序那里检索数据，它必须借助“屏幕搜索”- 捕获带有它所
      需数据的屏幕图片，并试图弄清如何把图片解释回数据。这样做效率非常低，并且
      容易产生错误。XML 为 XML Web 服务提供了一种格式，使其能够交换实际数据而不
      是包含数据的图片。}

  \item<2-> SOAP \only<3->{-- 简单对象访问协议}

    \only<2>{\CJKindent \small 它使应用程序可以通过一种标准的，松耦合的方式相互
      调用，这使生成在 Internet 上分发的应用程序成为可能。

      如果您将 XML Web 服务之间的交互想象成电话通话，那么 XML 描述了应用程序在
      它们的对话中相互所说的内容，SOAP 则描述了它们在电话里是如何呼叫对方的。}

    % 与 XML 一样，SOAP 是 W3C 标准过程的一部分，是由 Microsoft 和包括 IBM 在内
    % 的很多其他公司联合建议的。 XML 和 SOAP 实际上已经得到了业内主要软件供应商
    % 的公开认可，包括 Microsoft, IBM, HP, Sun 和 Oracle。

  \item<3-> UDDI \only<4->{-- 统一描述、发现和集成}

    \only<3>{\CJKindent \small 如果说 XML 是对话，SOAP 描述了您呼叫他人的规则，
      那么UDDI就是电话号码簿。UDDI 提供了一个 XML Web 服务的目录，便于查找提
      供 XML Web 服务的企业。UDDI 现在是一个有超过 200 家公司参与的群体过
      程，UDDI 群体的目的是在未来某个时间将其提交到一个正式的标准组织。}

  \item<4-> WSDL \only<5->{-- Web 服务描述语言}

    \only<4>{\CJKindent \small WSDL 提供了一个标准方法，用以描述一个特定 XML
      Web 服务提供何种函数，以及调用这些函数时必须传递哪些参数。与 SOAP 一
      样，WSDL已经提交给 W3C 进行标准化。}

  \item<5-> C\#, CLI \only<6->{-- .NET 框架的一部分}

    \only<5>{\CJKindent \small Microsoft 为 XML Web 服务家族创建的一种编程语
      言C\#。并且已经提交给 ECMA 进行标准化。 Microsoft 还向 ECMA 提交
      了 Microsoft .NET 框架的一个子集，叫做公共语言结构 (CLI)。这将使其他供应
      商能够在各种平台上实现 CLI，以便用 .NET 框架提供的基本体系结构模型所写的
      软件可以在各种平台上用各种工具来创建。}

  \end{itemize}

  \only<6>{\CJKindent 这些都经过国际组织的标准化，因此有更好的通用性，任何厂商
    都可以根据标准规定实现自己的 .NET 产品}

\end{frame}

% 对于开发人员而言，丰富的类库，方便的集成，以及发布、部署和维护方便性显得尤为
% 重要

% \begin{frame} \frametitle{公共语言结构(CLI)}
%   \begin{block}{CLI(Common Language Infrastructure)}
%     CLI 标准定义了一个与平台无关的虚拟代码执行环境。由于没有指定操作系统，所以
%     可以在任何的系统上执行。
%   \end{block}
%   CLI 定义了一种中间语言(CIL)和一个类型系统(CTS)。首先将高级语言程序编译为CIL，
%   在执行的过程中编译为宿主机器的目标代码。

%   % C# ...
%   % Microsoft 的 CLI 实现就是 CLR
%   % CLR + FCL 就是 Microsoft .NET Framework

% \end{frame}

\begin{frame} \frametitle{Web 服务(Web Services)}
  \begin{block}{Web Services}
    {\CJKindent 可远程访问的应用程序组件，并且响应以~HTTP~为主访问请求，提供基于
    文本的信息服务。}
  \end{block}
  \begin{itemize}
  \item 提供了信息发布的标准方式，方便应用程序访问
  \item 信息不再是网页或文件，以根据需要各取所需
  \item 消除了使用不同组件模型、操作系统之间存在的差异
  \item 方便创建基于 Web 服务的分布式应用程序
  \end{itemize}
\end{frame}

\begin{frame}[fragile,t] \frametitle{Web 服务示例}

  \begin{itemize}
  \item http://www.webservicex.net/globalweather.asmx
  \item \only<1>{通过 SOAP 的访问} \only<2>{返回的结果}
  \end{itemize}

  \begin{onlyenv}<1>
\begin{lstlisting}[language=XML, showstringspaces=false]
POST /globalweather.asmx HTTP/1.1
Host: www.webservicex.net
Content-Type: text/xml; charset=utf-8
Content-Length: length
SOAPAction: "http://www.webserviceX.NET/GetWeather"

<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://  ...>
 <soap:Body>
  <GetWeather xmlns="http://www.webserviceX.NET">
   <CityName>Harbin</CityName>
   <CountryName>China</CountryName>
  </GetWeather>
 </soap:Body>
</soap:Envelope>
\end{lstlisting}
  \end{onlyenv}

  \begin{onlyenv}<2>
\begin{lstlisting}[language=XML, showstringspaces=false]
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: length

<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http:// ...>
 <soap:Body>
  <GetWeatherResponse 
           xmlns="http://www.webserviceX.NET">
   <GetWeatherResult>string</GetWeatherResult>
  </GetWeatherResponse>
 </soap:Body>
</soap:Envelope>
\end{lstlisting}
  \end{onlyenv}

\end{frame}

\begin{frame} \frametitle{Microsoft .NET框架}
  \begin{itemize}
  \item 互联网和分布式应用的开发平台
  \item .NET 框架是创建 Windows 应用程序的基础
  \item 丰富的类库简化了应用程序的开发，如 \\
    {\small ASP.NET, Windows Forms, ASP.NET Web Services, Enterprise Services, ADO.NET}
  \item .NET 类库提供开发所需的各种基本功能，可以支持各种类型的应用程序
  \item 类库屏蔽了底层细节，统一的编成模式，易于使用
  \item 容易维护、部署等
  \end{itemize}
\end{frame}

\begin{frame} \frametitle{.NET 框架的组成}
  \begin{itemize}
  \item 公共语言运行环境 (CLR)
  \item .NET 框架类库 (FCL)
    % 组成的内容 (文字)
  \end{itemize}
  % .NET 框架的层次图 (图)

  \input{pgf-dn/dn-framework}
\end{frame}

% 多种语言之间的交互

\section{CLR 公共语言运行环境}
\begin{frame} \frametitle{Common Language Runtime}
  \begin{block}{公共语言运行环境}
    
  \end{block}
\end{frame}

\begin{frame} \frametitle{CLR 中程序的运行}

\input{pgf-dn/clr-compile-exec}
  \begin{itemize}
  \item CLR 定义了一种基于栈的虚拟机
  \item CLR 上执行的代码是 CIL 编写的托管代码
  \item CIL 通过 JIT 实时的编译为本地代码
  \item CLR 是负责托管代码执行的虚拟运行环境
  \item MSIL 是 CIL 的一种实现
  \end{itemize}

\end{frame}

\begin{frame} \frametitle{CLR的功能和作用}
  \begin{itemize}
  \item 提供通用类型系统 (CTS)\\
    值类型：整数、浮点数、结构体等\\
    引用类型：类对象、委托、接口等
  \item 为托管代码执行提供服务\\
    智能内存管理，元数据管理，受管库的加载与分析，处理异常，代码互操作
  \item 访问系统资源\\
    Win32 API 或 COM 等
  \end{itemize}
\end{frame}

%\subsection*{公共类型系统}

\begin{frame} \frametitle{公共类型系统(CTS)}
  \begin{block}{Common Language System, CTS}
    公共类型系统是一组预定义的类型，以及所有类型行为的规范。
  \end{block}
  \begin{itemize}
  \item 定义了一个声明、使用和管理类型的标准化框架
  \item 使不同的编程语言之间的能够集成
  \item 遵循 CTS 能够保障类型的安全和性能的优化
  \item 遵循 CTS 的语言不一定支持 CTS 中定义的全部类型
  \end{itemize}
\end{frame}

\begin{frame} \frametitle{CTS的类型结构}
  % 所有的类型都派生自Objects类型，而所有的值类型都派生自ValueTypes类型。
  \input{pgf-dn/cts-typesystem}
\end{frame}


\begin{frame} \frametitle{值类型和引用类型}
  值类型和引用类型的区别：

  \input{pgf-dn/cts-v-r-types}

  % 托管代码执行过程中，变量可以在托管栈或托管堆中分配。
  % 当方法被调用时，局部变量或方法创建的值类型变量都在栈中分配，当方法运行结束时都自动的释放；           
  % 而在堆中分配的变量，并不自动释放，而是通过“垃圾处理”来由CLR管理并释放。

  % 值类型的变量在栈中分配，而引用类型的变量在栈中只有一个引用，指向在堆中实际内存

\end{frame}

%\subsection*{托管代码的编译}
\begin{frame} \frametitle{托管代码的编译}
  
  \begin{itemize}
  \item 托管代码编译后生成 MSIL 和元数据
    
%    {\footnotesize MSIL和元数据都存储在Windows PE文件中，存在形式可以是 DLL 或EXE。}

\item MSIL 和元数据都保存在 DLL 或 EXE 中

  % {\footnotesize MSIL相当于CLR的汇编语言，而且直接支持 CTS 中的各种类型和比较
  %   高级的操作，比如创建对象、类型之间的转换等。}

\item 元数据描述源代码中定义类型的详细信息
  % {\footnotesize 类的名字、可见性、基类，该类实现的接口、方法、属性和时间等等。}


  \end{itemize}

\input{pgf-dn/clr-compile}

\end{frame}

\begin{frame} \frametitle{托管代码的组织}
  \begin{block}{程序集(Assembly)}
    \small .NET 框架应用程序中，由一个或一组文件构成的，单一功能的逻辑单元。程
    序集是组件复用，实施安全策略的最小单位。
  \end{block}
  \begin{itemize}
  \item 程序集可以有一个或多个文件，如DLL, EXE 或资源文件等
  \item 程序集都有一个清单(manifest)
  \item 清单描述程序集的内容信息
    \begin{enumerate}
    \item 程序集的名字
    \item 版本号，形如 major.minor.build.revision
    \item 支持的语言
    \item 程序集其他文件列表
    \item 所依赖的其他程序集及版本号
    \end{enumerate}
  \end{itemize}
\end{frame}

\begin{frame} \frametitle{程序集的功能}
  \begin{itemize}
  \item 程序集定义了类型的有效范围
    % CLR 通过程序集查找类的定义
  \item 程序集不需要注册表项
    % CLR 通过一种算法查找程序集的位置 
  \item 安装 .NET 应用程序，只拷贝它的程序集即可
    % 安装与卸载 .NET 模块不需要修改系统注册表，只需copy or delete

  \item 程序集可以有一个 Strong name
    \begin{itemize}
    \item 除了三个必须的成员之外，还要有数字签名和相应的公钥
    \item 通过数字签名，可以确保程序集的唯一性，增加安全性
    \end{itemize}

  \item 允许不同版本的程序集并存，可有效避免 DLL Hell
    % 因为程序集需要指定版本号，而程序集的依赖也如此
  \end{itemize}
\end{frame}

%\subsection*{CLR的执行模型}
% CIL

%\subsection*{托管代码的执行}
\begin{frame} \frametitle{托管代码的执行}
  \framesubtitle{如何寻找并加载程序集}
  \begin{itemize}
  \item 只有在需要的时候加载
    % 如果依赖程序集没有调用，不会被加载；
    % 程序集甚至不需在目标机器上

  \item CLR通过特定的规则寻找需要的程序集
    % 
    \begin{enumerate}
    \item CLR检查是否已经被加载，如果已经加载，结束搜索
    \item 在Global Assembly Cache(GAC)中搜索
    \item 在程序代码中指定的位置搜索
    \item 如果代码没有指定，在Application base查找，可能是目录或URL
    \item 根据 .NET 的配置，在其他目录查找
    \item 都未找到，报告错误，结束
    \end{enumerate}

  \item 检查Strong name(如果有)，加载并使用
  \end{itemize}
\end{frame}

\begin{frame} \frametitle{托管代码的执行}
  \framesubtitle{编译MSIL}

\end{frame}

\begin{frame} \frametitle{托管代码的实时编译}
  \begin{onlyenv}<2->
    \input{pgf-dn/clr-execute}
  \end{onlyenv}
\end{frame}



\section{.NET 框架类库(FCL)}
% 名子空间
% 
\begin{frame}
  Microsoft .NET 框架提供了功能丰富的类库，这些类库 .NET 框架应用程序的基础。这
  些类库的应用十分广泛，从基本的输入输出，文本处理，到数据库应用、Web应用一应俱
  全。
% 学习 .NET 开发的过程，基本上也是学习 .NET FCL 的过程
  \begin{itemize}
  \item 类库结构是一个命名空间(namespace)的树形结构
  \item 命名空间 System 是树形结构的根
  \item 命名空间下可以有子命名空间或类(class)
  \item 命名空间或类之间通过''.''连接
  \end{itemize}
\end{frame}

\begin{frame} \frametitle{命名空间的结构}
\input{pgf-dn/fcl-namespaces}
  % 图
\end{frame}

\begin{frame} \frametitle{基本的类库简介}
  \begin{itemize}
  \item System.IO -- 文件或目录的访问

    基本的输入输出，文件、目录以及内存数据流的访问。

  \item System.Net -- 网络数据的访问

    使用各种网络协议 HTTP, FTP, Mail, 基本的 Socket 等进行网络数据通信，简化了
    网络应用程序的开发。

  \item System.Text -- 文本处理

    提供不同编码文本之间的转换功能，文本处理功能，正则表达式搜索及匹配文本等等。

  \item System.Data -- ADO.NET 的基础

    实现了 ADO.NET 的类库，用于访问各种数据源，比如 System.Data.SqlClient,
    System.Data.OracleClient, System.Data.ODBC等等。

    % System.Threading, System.Web, System.Windows, System.XML

  \end{itemize}
\end{frame}

\begin{frame} \frametitle{公共语言运行环境}
  .NET 提供的运行环境，管理代码执行，简化开发过程
\end{frame}


%\subsection*{受管开发环境}

%\subsection*{垃圾回收}

\section{.NET 语言}



% Local Variables: 
% mode: LaTeX
% coding: gb2312
% TeX-master: "lesson-01.tex"
% End:
