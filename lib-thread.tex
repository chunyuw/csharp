%% Slides for ".NET Programming" by Chunyu Wang <chunyu@hit.edu.cn> %% $Rev$

\section{多线程}

% http://msdn2.microsoft.com/zh-cn/library/system.threading.aspx

\begin{frame}
\frametitle{多线程~(\textit{Multithreading})}
\begin{block}{\textit{Thread}}
  \CJKindent 线程本质上是一个独立运行的代码段，.NET 中实际是操作系统线程的包装
  器，由操作系统创建和运行。
\end{block}
% http://msdn2.microsoft.com/zh-cn/library/6kac2kdh.aspx
\begin{itemize}
\item 提高性能，可以将任务分解在多个线程中
\item 提高响应能力，如在通过网络发送文件的同时，接受键盘输入
\end{itemize}
\medskip
\begin{itemize}
\item 程序稍复杂，需要启动、监视、等待线程结束等
\item 多个线程使用同一资源，需要进行同步
\item 多线程之间可能发生死锁，使用时需要注意
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{System.Threading 命名空间}
\begin{itemize}
\item .NET 的线程类在 System.Threading 命名空间
\item Thread 类用于创建线程，设置优先级，挂起、激活或终止线程等
\item Monitor
\item Mutex
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Thread 类}
Thread 类用于创建并控制线程，设置其优先级并获取其状态。

Thread 类的构造函数：

\begin{itemize}
\item public Thread(ThreadStart) --- 创建一个线程
\item ThreadStart --- 委托，表示此线程开始执行时要调用的方法
\item ParameterizedThreadStart --- 允许对象在线程启动时传递给线程的委托
\item 此外还可以指定一个整数限制堆栈大小
\end{itemize}

线程创建后，通过 ~Start 方法开始线程的运行
\begin{itemize}
\item void Start() --- 开始执行线程
\item void Start(Object) --- 开始执行线程，并提供一个参数
\end{itemize}
线程一旦终止，它就无法通过再次调用 Start 来重新启动。

\end{frame}

\begin{frame}[fragile,plain]
\frametitle{创建并运行线程}
\begin{lstlisting}
using System;  using System.Threading;

public class ThreadExample {
  public static void ThreadProc() {
    for (int i = 0; i < 10; i++) {
      Console.WriteLine("ThreadProc: {0}", i);
      Thread.Sleep(0); }
  }

  public static void Main() {
    Console.WriteLine("Main thread: Start a second thread.");
    Thread t = new Thread(new ThreadStart(ThreadProc));
    t.Start();
    //Thread.Sleep(0);

    for (int i = 0; i < 4; i++) {
      Console.WriteLine("Main thread: Do some work.");
      Thread.Sleep(0);
    }

    Console.WriteLine("Main thread: Call Join(), to wait until ThreadProc ends.");
    t.Join();
    Console.WriteLine("Main thread: ThreadProc.Join has returned.  Press Enter to end program.");
    Console.ReadLine();
  }
}
\end{lstlisting}
\end{frame}


\begin{frame}
\frametitle{Thread 类的成员特性}
\begin{itemize}
\item static Thread CurrentThread --- 获取当前正在运行的线程
\item bool IsAlive --- 获取当前线程的执行状态
\item bool IsBackground --- 获取或设置一个值，该值指示某个线程是否为后台线程
\item bool IsThreadPoolThread --- 是否属于托管线程池
\item int ManagedThreadId --- 获取当前托管线程的唯一标识符
\item string Name --- 获取或设置线程的名称
\item ThreadPriority Priority --- 获取或设置一个值，该值指示线程的调度优先级
\item ThreadState ThreadState --- 获取一个值，该值包含当前线程的状态
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Thread 类的成员方法}
\begin{itemize}
\item void Abort() --- 引发 ThreadAbortException，以开始终止此线程的过程
\item void Interrupt() --- 中断处于 WaitSleepJoin 线程状态的线程
\item void Join() --- 阻塞调用线程，直到某个线程终止为止
\item bool Join(int/TimeSpan) --- 阻塞调用线程，直到某个线程终止或经过了指定时间为止
\item static void Sleep(int/TimeSpan) --- 将当前线程挂起指定的时间
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{创建多个线程}

\end{frame}

\begin{frame}
\frametitle{判断线程的结束}

\end{frame}

\begin{frame}
\frametitle{线程状态}

\end{frame}

\begin{frame}
\frametitle{传递线程参数}

\end{frame}

\begin{frame}
\frametitle{线程的优先级}

\end{frame}

\begin{frame}
\frametitle{线程同步}
% lock, Wait(), Pulse(), PulseAll()
\end{frame}

\begin{frame}
\frametitle{Mutex 类}

\end{frame}

\begin{frame}
\frametitle{Semaphore 类}

\end{frame}


\begin{frame}
\frametitle{线程终止}

\end{frame}

\begin{frame}
\frametitle{Monitor 类}

\end{frame}

\begin{frame}
\frametitle{Interlocked 类}

\end{frame}

\begin{frame}
\frametitle{ThreadPool 类}
% http://msdn2.microsoft.com/zh-cn/library/0ka9477y.aspx
\end{frame}

\begin{frame}
\frametitle{Timer 类}

\end{frame}

\begin{frame}
\frametitle{线程相关的异常}

\end{frame}


% Local Variables:
% mode: LaTeX
% TeX-master: "part-04.tex"
% TeX-header-end: "% End-of-Header$"
% TeX-trailer-start: "% Start-of-Trailer$"
% fill-column: 100
% coding: gb2312-dos
% End:

